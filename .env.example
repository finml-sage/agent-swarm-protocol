# Agent Swarm Protocol - Environment Configuration
# Copy this file to .env and configure your values
#
# Variables marked [required] must be set. The server will fail to start without them.
# Variables marked [optional] have sensible defaults shown after the = sign.

# ---------------------------------------------------------------------------
# MIGRATION NOTE (v0.4+)
# ---------------------------------------------------------------------------
# Wake trigger and wake endpoint are now ENABLED BY DEFAULT.
# If your deployment relied on wake being disabled (the previous default),
# add these lines to your .env to restore the old behaviour:
#
#   WAKE_ENABLED=false
#   WAKE_EP_ENABLED=false
#
# The default invoke method remains 'noop' (no agent invocation), so
# enabling wake with no other configuration is safe -- it only means the
# /api/wake endpoint is mounted and wake trigger POSTs are attempted.

# ---------------------------------------------------------------------------
# Identity
# ---------------------------------------------------------------------------

# [required] Your agent's unique identifier (e.g. GitHub username)
AGENT_ID=your-agent-id

# [required] Public HTTPS endpoint where other agents can reach this server.
# Read by config.py. Also constructed by docker-compose.yml as
# https://${DOMAIN}/swarm -- set DOMAIN below if using Docker.
AGENT_ENDPOINT=https://agent.example.com/swarm

# [required] Base64-encoded Ed25519 public key for signature verification
AGENT_PUBLIC_KEY=your-base64-encoded-public-key

# ---------------------------------------------------------------------------
# Database
# ---------------------------------------------------------------------------

# [optional] Path to the SQLite database file.
# For Docker: the compose file sets this to /app/data/swarm.db inside the container.
# For host deployment: set to a shared path so CLI, server, and hooks all use
# the same database (e.g. /home/agent/.swarm/swarm.db).
# Default: data/swarm.db
DB_PATH=data/swarm.db

# ---------------------------------------------------------------------------
# Docker / Angie (used by docker-compose.yml, not by Python directly)
# ---------------------------------------------------------------------------

# [required for Docker] Domain name for TLS certificate and Angie server_name.
# Also used by docker-compose.yml to derive AGENT_ENDPOINT.
DOMAIN=agent.example.com

# [optional] Host path to Ed25519 private key file, mounted into the container.
# Default: ./keys/private.pem
PRIVATE_KEY_PATH=./keys/private.pem

# ---------------------------------------------------------------------------
# Optional: Agent metadata
# ---------------------------------------------------------------------------

# Human-readable display name returned by /swarm/info
AGENT_NAME=My Agent

# Short description returned by /swarm/info
AGENT_DESCRIPTION=A swarm protocol agent

# ---------------------------------------------------------------------------
# Optional: Rate limiting (applied per-IP by middleware)
# ---------------------------------------------------------------------------

# Max inbound messages per minute (default: 60)
RATE_LIMIT_MESSAGES_PER_MINUTE=60

# Max join requests per hour (default: 10)
RATE_LIMIT_JOIN_PER_HOUR=10

# ---------------------------------------------------------------------------
# Optional: Internal queue
# ---------------------------------------------------------------------------

# Maximum queued messages before back-pressure (default: 10000)
QUEUE_MAX_SIZE=10000

# ---------------------------------------------------------------------------
# Wake trigger (outbound: POST to wake endpoint when messages arrive)
# Enabled by default. Set WAKE_ENABLED=false to disable.
# ---------------------------------------------------------------------------

# [optional] Enable/disable the wake trigger (default: true)
WAKE_ENABLED=true

# [optional] URL to POST when a new message arrives (default: http://localhost:8080/api/wake)
WAKE_ENDPOINT=http://localhost:8080/api/wake

# [optional] Timeout in seconds for wake POST requests (default: 5.0)
WAKE_TIMEOUT=5.0

# ---------------------------------------------------------------------------
# Wake endpoint (inbound: /api/wake receives POSTs and invokes the agent)
# Enabled by default. Set WAKE_EP_ENABLED=false to disable.
# ---------------------------------------------------------------------------

# [optional] Enable/disable the /api/wake endpoint (default: true)
WAKE_EP_ENABLED=true

# [optional] Invocation method: 'subprocess', 'webhook', 'sdk', 'tmux', or 'noop' (default: noop)
# - subprocess: runs a shell command (set WAKE_EP_INVOKE_TARGET)
# - webhook: POSTs to a URL (set WAKE_EP_INVOKE_TARGET)
# - sdk: invokes via Claude Agent SDK (pip install agent-swarm-protocol[wake])
# - tmux: sends a notification into a running tmux session via send-keys
#          (set WAKE_EP_TMUX_TARGET). No SDK required.
# - noop: does nothing (safe default)
WAKE_EP_INVOKE_METHOD=noop

# [required when method is subprocess or webhook]
# Subprocess example: claude --prompt "Process swarm message: {message_id}"
# Webhook example: http://localhost:9090/invoke
#WAKE_EP_INVOKE_TARGET=

# [optional] Shared secret for X-Wake-Secret header authentication.
# WARNING: When empty and WAKE_EP_ENABLED=true, the endpoint accepts
# unauthenticated requests. Set a strong secret in production.
#WAKE_EP_SECRET=

# [optional] Path to session state file for duplicate-invocation guard
# (default: /root/.swarm/session.json)
WAKE_EP_SESSION_FILE=/root/.swarm/session.json

# [optional] Minutes before an active session is considered expired (default: 30)
WAKE_EP_SESSION_TIMEOUT=30

# ---------------------------------------------------------------------------
# Wake endpoint: Claude Agent SDK options (used when WAKE_EP_INVOKE_METHOD=sdk)
# ---------------------------------------------------------------------------

# [optional] Working directory for SDK sessions (default: /root/nexus)
#WAKE_EP_SDK_CWD=/root/nexus

# [optional] SDK permission mode (default: acceptEdits)
#WAKE_EP_SDK_PERMISSION_MODE=acceptEdits

# [optional] Maximum conversation turns per invocation
#WAKE_EP_SDK_MAX_TURNS=

# [optional] Model override (omit to use SDK default)
#WAKE_EP_SDK_MODEL=

# ---------------------------------------------------------------------------
# Wake endpoint: Tmux options (used when WAKE_EP_INVOKE_METHOD=tmux)
# ---------------------------------------------------------------------------

# [required when method is tmux] Tmux session/window/pane target.
# A notification is sent to this tmux target via 'tmux send-keys'.
# No SDK or AI relay -- just a direct subprocess call.
# Examples: 'main:0', 'orchestrator', 'nexus:0.0'
#WAKE_EP_TMUX_TARGET=main:0
