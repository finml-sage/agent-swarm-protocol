# Agent Swarm Protocol - Development Overrides
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  handler:
    build:
      context: .
      dockerfile: Dockerfile.dev
    environment:
      - AGENT_ID=dev-agent-001
      - AGENT_ENDPOINT=https://localhost/swarm
      - AGENT_PUBLIC_KEY=dev-public-key-placeholder
      - AGENT_NAME=Development Agent
      - AGENT_DESCRIPTION=Local development instance
      - PRIVATE_KEY_PATH=/app/keys/private.pem
      - DATABASE_PATH=/app/data/state.db
      - LOG_LEVEL=DEBUG
    volumes:
      - ./src:/app/src:ro
      - ./data:/app/data
      - ./keys:/app/keys:ro
    ports:
      - "8080:8080"
    networks:
      - internal
      - external
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '2.0'

  angie:
    volumes:
      - ./docker/angie/angie.dev.conf:/etc/angie/angie.conf:ro
      - ./docker/angie/conf.d:/etc/angie/conf.d:ro
      - ./docker/angie/certs/dev:/etc/letsencrypt/live/localhost:ro
      - ./docker/angie/acme:/var/www/acme
      - ./logs/angie:/var/log/angie
    environment:
      - DOMAIN=localhost
      - UPSTREAM_HOST=handler
      - UPSTREAM_PORT=8080
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '1.0'
